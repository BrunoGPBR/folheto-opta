<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Folheto Opta - Interativo + Leitor HD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="stpageflip.min.css" />
  <style>
    /* Fundo preto e texto branco para contraste */
    body {
      margin: 0;
      background: #000;
      height: 100vh;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
    }

    #flipbook {
      width: 100vw;
      height: 100vh;
    }

    /* Cores base laranja do folder */
    :root {
      --main-orange: #ff6a00;
      --main-orange-light: #ff944d;
      --main-orange-shadow: rgba(255, 106, 0, 0.25);
      --main-orange-dark: #cc5600;
    }

    /* Botão fullscreen estilizado quadrado moderno */
    #fullscreenBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--main-orange);
      border: none;
      padding: 14px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      z-index: 10;
      transition: background 0.35s cubic-bezier(0.4, 0, 0.2, 1), transform 0.25s ease;
      outline-offset: 2px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      font-weight: 700;
      user-select: none;
      box-shadow: 0 4px 18px var(--main-orange-shadow);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    #fullscreenBtn:hover,
    #fullscreenBtn:focus {
      background: var(--main-orange-dark);
      transform: scale(1.1);
      outline: 3px solid var(--main-orange-light);
      box-shadow: 0 6px 25px var(--main-orange-shadow);
    }

    #fullscreenBtn svg {
      fill: white;
      width: 22px;
      height: 22px;
      flex-shrink: 0;
      transition: fill 0.35s ease;
    }

    /* Tela cheia */
    #fullscreenViewer {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      animation: fadeIn 0.3s ease-in-out;
      padding: 24px;
      box-sizing: border-box;
      user-select: none;
      overflow: hidden;
    }

    /* Container do zoom com overflow hidden */
    #zoomContainer {
      position: relative;
      width: 90vw;
      max-width: 1000px;
      height: 85vh;
      border-radius: 12px;
      overflow: hidden;
      box-shadow:
        0 0 25px var(--main-orange),
        inset 0 0 24px var(--main-orange-light);
      background: #111;
      cursor: grab;
      touch-action: none; /* para gestos */
      transition: box-shadow 0.3s ease;
    }
    #zoomContainer:active {
      cursor: grabbing;
    }

    #viewerImage {
      position: absolute;
      top: 50%;
      left: 50%;
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      transform-origin: center center;
      user-select: none;
      filter: drop-shadow(0 0 6px var(--main-orange));
      pointer-events: none;
      transition: filter 0.3s ease;
      /* PRINCIPAL CORREÇÃO: Inclui translate(-50%, -50%) para centralizar e depois adiciona pan e zoom */
      transform: translate(calc(-50% + 0px), calc(-50% + 0px)) scale(1);
    }
    #zoomContainer:hover #viewerImage {
      filter: drop-shadow(0 0 12px var(--main-orange-light));
    }

    /* Botões navegação e fechar quadrados modernos */
    .nav-btn, .close-btn {
      background: #1a1a1a;
      border: none;
      cursor: pointer;
      outline-offset: 3px;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), color 0.35s ease, box-shadow 0.3s ease, background 0.3s ease;
      color: var(--main-orange);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 12px var(--main-orange-shadow);
      font-weight: 600;
      will-change: transform;
      width: 48px;
      height: 48px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-clip: padding-box;
      border: 2px solid transparent;
      box-sizing: border-box;
    }

    .nav-btn svg, .close-btn svg {
      fill: var(--main-orange);
      width: 28px;
      height: 28px;
      pointer-events: none;
      transition: fill 0.35s ease;
    }

    .nav-btn:hover,
    .nav-btn:focus {
      color: var(--main-orange-light);
      background: #2a1a00;
      box-shadow: 0 0 24px var(--main-orange-light);
      border-color: var(--main-orange-light);
      transform: scale(1.2);
      outline: none;
    }

    .nav-btn:disabled {
      color: #444;
      box-shadow: none;
      background: #0f0f0f;
      cursor: default;
      border-color: transparent;
    }

    .close-btn {
      position: absolute;
      top: 24px;
      right: 24px;
      width: 48px;
      height: 48px;
      color: var(--main-orange);
      box-shadow: 0 0 20px var(--main-orange-shadow);
      will-change: transform;
      background: #1a1a1a;
      border: 2px solid transparent;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .close-btn:hover,
    .close-btn:focus {
      color: var(--main-orange-light);
      background: #2a1a00;
      border-color: var(--main-orange-light);
      box-shadow: 0 0 36px var(--main-orange-light);
      transform: scale(1.25);
      outline: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.97); }
      to { opacity: 1; transform: scale(1); }
    }

    /* Responsivo */
    @media (max-width: 768px) {
      #fullscreenBtn {
        padding: 12px 18px;
        font-size: 14px;
      }
      .nav-btn, .close-btn {
        width: 40px;
        height: 40px;
      }
      #zoomContainer {
        width: 94vw;
        height: 75vh;
      }
      .nav-btn svg, .close-btn svg {
        width: 22px;
        height: 22px;
      }
    }
  </style>
</head>
<body>

<button id="fullscreenBtn" aria-label="Ver folheto em alta qualidade no modo tela cheia" title="Ver em Alta Qualidade" type="button">
  <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
    <path d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 001.48-5.34C15.39 5.61 13.28 3.5 10.5 3.5S5.61 5.61 5.61 8.39 7.72 13.28 10.5 13.28a6.471 6.471 0 005.34-1.48l.27.28v.79l4.25 4.25c.4.4 1.04.4 1.44 0s.4-1.05 0-1.45L15.5 14zm-5 0C9.01 14 7 11.99 7 9.5S9.01 5 11.5 5 16 7.01 16 9.5 13.99 14 11.5 14z"/>
  </svg>
  Ver em Alta Qualidade
</button>

<main>
  <section aria-label="Folheto digital interativo">
    <div id="flipbook" role="region" aria-live="polite" aria-label="Folheto interativo com páginas viráveis"></div>
  </section>
</main>

<div id="fullscreenViewer" role="dialog" aria-modal="true" aria-labelledby="fullscreenTitle" tabindex="-1">
  <button class="close-btn" onclick="closeFullscreen()" aria-label="Fechar visualizador em tela cheia" title="Fechar" type="button" >
    <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M18.3 5.71a1 1 0 00-1.41 0L12 10.59 7.11 5.7a1 1 0 00-1.41 1.42L10.59 12l-4.89 4.89a1 1 0 001.41 1.41L12 13.41l4.89 4.89a1 1 0 001.41-1.41L13.41 12l4.89-4.89a1 1 0 000-1.4z"/>
    </svg>
  </button>
  <div id="zoomContainer" role="region" aria-label="Visualização em alta qualidade com zoom">
    <img id="viewerImage" src="" alt="Página ampliada do folheto" onerror="imageLoadError()" />
  </div>
  <div style="margin-top: 18px; display: flex; gap: 16px;">
    <button class="nav-btn" onclick="prevImage()" aria-label="Página anterior" title="Página Anterior" type="button" >
      <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
      </svg>
    </button>
    <button class="nav-btn" onclick="nextImage()" aria-label="Próxima página" title="Próxima" type="button" >
      <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
        <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/>
      </svg>
    </button>
  </div>
</div>

<script src="stpageflip.min.js"></script>
<script>
  const fullscreenImages = [
    "https://i.imgur.com/uH4uk5l.jpeg",
    "https://i.imgur.com/aoCOVms.jpeg",
    "https://i.imgur.com/VWWJ1z5.jpeg",
    "https://i.imgur.com/JVglSjP.jpeg"
  ];

  let currentImage = 0;

  // Variáveis para zoom e pan
  let scale = 1;
  let translateX = 0;
  let translateY = 0;
  let isDragging = false;
  let startX = 0;
  let startY = 0;

  const zoomContainer = document.getElementById('zoomContainer');
  const viewerImage = document.getElementById('viewerImage');

  function applyTransform() {
    // Aplica translate(-50%, -50%) para centralizar + pan e escala
    viewerImage.style.transform = `translate(calc(-50% + ${translateX}px), calc(-50% + ${translateY}px)) scale(${scale})`;
  }

  // Mouse wheel para zoom (desktop)
  function onWheel(e) {
    e.preventDefault();
    const zoomStep = 0.1;
    let oldScale = scale;
    if (e.deltaY < 0) {
      scale += zoomStep;
    } else {
      scale -= zoomStep;
    }
    scale = Math.min(Math.max(1, scale), 5);

    const bounds = zoomContainer.getBoundingClientRect();
    const offsetX = e.clientX - bounds.left;
    const offsetY = e.clientY - bounds.top;

    const dx = (offsetX - (bounds.width / 2) - translateX) * (scale / oldScale - 1);
    const dy = (offsetY - (bounds.height / 2) - translateY) * (scale / oldScale - 1);

    translateX -= dx;
    translateY -= dy;

    limitPan();
    applyTransform();
  }

  // Limitar pan para não sair a imagem da viewport
  function limitPan() {
    if (!viewerImage.naturalWidth || !viewerImage.naturalHeight) return;

    const bounds = zoomContainer.getBoundingClientRect();

    const scaledWidth = viewerImage.naturalWidth * scale;
    const scaledHeight = viewerImage.naturalHeight * scale;

    const halfContainerWidth = bounds.width / 2;
    const halfContainerHeight = bounds.height / 2;

    // Limites máximos e mínimos
    const minX = Math.min(0, halfContainerWidth - scaledWidth / 2);
    const maxX = Math.max(0, scaledWidth / 2 - halfContainerWidth);
    const minY = Math.min(0, halfContainerHeight - scaledHeight / 2);
    const maxY = Math.max(0, scaledHeight / 2 - halfContainerHeight);

    if (translateX < minX) translateX = minX;
    if (translateX > maxX) translateX = maxX;
    if (translateY < minY) translateY = minY;
    if (translateY > maxY) translateY = maxY;
  }

  function onMouseDown(e) {
    if (scale <= 1) return; // não drag se zoom = 1
    e.preventDefault();
    isDragging = true;
    startX = e.clientX - translateX;
    startY = e.clientY - translateY;
    zoomContainer.style.cursor = 'grabbing';
  }

  function onMouseMove(e) {
    if (!isDragging) return;
    e.preventDefault();
    translateX = e.clientX - startX;
    translateY = e.clientY - startY;
    limitPan();
    applyTransform();
  }

  function onMouseUp() {
    if (isDragging) {
      isDragging = false;
      zoomContainer.style.cursor = 'grab';
    }
  }

  // Touch handlers para mobile (pinch zoom e pan)
  let lastTouchDistance = null;
  let lastTouchMidpoint = null;
  let isTouchPanning = false;
  let lastTouchPos = null;

  function getDistance(touches) {
    const [touch1, touch2] = touches;
    const dx = touch2.clientX - touch1.clientX;
    const dy = touch2.clientY - touch1.clientY;
    return Math.sqrt(dx*dx + dy*dy);
  }

  function getMidpoint(touches) {
    const [touch1, touch2] = touches;
    return {
      x: (touch1.clientX + touch2.clientX) / 2,
      y: (touch1.clientY + touch2.clientY) / 2
    };
  }

  function onTouchStart(e) {
    if (e.touches.length === 2) {
      e.preventDefault();
      lastTouchDistance = getDistance(e.touches);
      lastTouchMidpoint = getMidpoint(e.touches);
      isTouchPanning = false;
    } else if (scale > 1 && e.touches.length === 1) {
      isTouchPanning = true;
      lastTouchPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }
  }

  function onTouchMove(e) {
    if (e.touches.length === 2 && lastTouchDistance != null) {
      e.preventDefault();
      const newDistance = getDistance(e.touches);
      const zoomStep = (newDistance - lastTouchDistance) / 200; 

      let oldScale = scale;
      scale += zoomStep;
      scale = Math.min(Math.max(1, scale), 5);

      const bounds = zoomContainer.getBoundingClientRect();
      const offsetX = lastTouchMidpoint.x - bounds.left;
      const offsetY = lastTouchMidpoint.y - bounds.top;

      const dx = (offsetX - (bounds.width / 2) - translateX) * (scale / oldScale - 1);
      const dy = (offsetY - (bounds.height / 2) - translateY) * (scale / oldScale - 1);

      translateX -= dx;
      translateY -= dy;

      lastTouchDistance = newDistance;
      lastTouchMidpoint = getMidpoint(e.touches);

      limitPan();
      applyTransform();

    } else if(isTouchPanning && e.touches.length === 1) {
      e.preventDefault();
      const touch = e.touches[0];
      let dx = touch.clientX - lastTouchPos.x;
      let dy = touch.clientY - lastTouchPos.y;

      translateX += dx;
      translateY += dy;
      limitPan();
      applyTransform();

      lastTouchPos = { x: touch.clientX, y: touch.clientY };
    }
  }

  function onTouchEnd(e) {
    if(e.touches.length < 2) lastTouchDistance = null;
    if(e.touches.length === 0) {
      isTouchPanning = false;
    }
  }


  /*
    Controle da navegação e atualização da imagem na visualização fullscreen
  */
  function openFullscreen() {
    const viewer = document.getElementById("fullscreenViewer");
    viewer.style.display = "flex";
    viewer.focus();
    currentImage = 0;
    resetTransform();
    updateImage();
  }

  function closeFullscreen() {
    const viewer = document.getElementById("fullscreenViewer");
    viewer.style.display = "none";
  }

  function updateImage() {
    viewerImage.src = fullscreenImages[currentImage];
    viewerImage.alt = `Página ${currentImage + 1} ampliada do folheto`;
    resetTransform();
    updateNavButtons();
  }

  function imageLoadError() {
    viewerImage.alt = "Erro ao carregar a imagem.";
    viewerImage.src = "https://via.placeholder.com/800x1120?text=Imagem+indispon%C3%ADvel";
  }

  function nextImage() {
    if(currentImage < fullscreenImages.length - 1) {
      currentImage++;
      updateImage();
    }
  }

  function prevImage() {
    if(currentImage > 0) {
      currentImage--;
      updateImage();
    }
  }

  function updateNavButtons(){
    const prevBtn = document.querySelector('.nav-btn[onclick="prevImage()"]');
    const nextBtn = document.querySelector('.nav-btn[onclick="nextImage()"]');
    prevBtn.disabled = currentImage === 0;
    nextBtn.disabled = currentImage === fullscreenImages.length - 1;
  }

  function resetTransform(){
    scale = 1;
    translateX = 0;
    translateY = 0;
    applyTransform();
  }

  // Eventos mouse e touch para zoom e pan
  zoomContainer.addEventListener('wheel', onWheel, { passive: false });
  zoomContainer.addEventListener('mousedown', onMouseDown);
  window.addEventListener('mouseup', onMouseUp);
  window.addEventListener('mousemove', onMouseMove);

  zoomContainer.addEventListener('touchstart', onTouchStart, { passive: false });
  zoomContainer.addEventListener('touchmove', onTouchMove, { passive: false });
  zoomContainer.addEventListener('touchend', onTouchEnd);
  zoomContainer.addEventListener('touchcancel', onTouchEnd);

  // Navegação por teclado
  document.addEventListener("keydown", function(e) {
    const viewer = document.getElementById("fullscreenViewer");
    if (viewer.style.display === "flex") {
      if (e.key === "ArrowRight" || e.key === "ArrowDown") {
        nextImage();
      } else if (e.key === "ArrowLeft" || e.key === "ArrowUp") {
        prevImage();
      } else if (e.key === "Escape") {
        closeFullscreen();
      }
    }
  });

  document.getElementById("fullscreenBtn").addEventListener("click", openFullscreen);

  // Inicializa StPageFlip
  document.addEventListener("DOMContentLoaded", () => {
    const pageFlip = new St.PageFlip(document.getElementById("flipbook"), {
      width: 800,
      height: 1120,
      size: "stretch",
      usePortrait: window.innerWidth < 768,
      minWidth: 315,
      maxWidth: 1600,
      minHeight: 400,
      maxHeight: 2400,
      drawShadow: true,
      flippingTime: 800,
      startPage: 0,
      autoSize: true,
      maxShadowOpacity: 0.4,
      showCover: true,
      mobileScrollSupport: true
    });

    pageFlip.loadFromImages([
      "https://i.imgur.com/uH4uk5l.jpeg",
      "https://i.imgur.com/aoCOVms.jpeg",
      "https://i.imgur.com/VWWJ1z5.jpeg",
      "https://i.imgur.com/JVglSjP.jpeg",
      "https://i.imgur.com/Gf6qv4V.jpeg"
    ]);

    pageFlip.on("flip", (e) => {
      const total = pageFlip.getPageCount();
      if (e.data === 0) {
        pageFlip.updateState({ disableFlip: "backward" });
      } else if (e.data === total - 1) {
        pageFlip.updateState({ disableFlip: "forward" });
      } else {
        pageFlip.updateState({ disableFlip: false });
      }
    });
  });
</script>

</body>
</html>

